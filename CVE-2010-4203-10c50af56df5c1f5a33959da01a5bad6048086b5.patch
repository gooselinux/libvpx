From: John Koleszar <jkoleszar@google.com>
Date: Thu, 4 Nov 2010 20:59:26 +0000 (-0400)
Subject: fix integer promotion bug in partition size check
X-Git-Url: https://review.webmproject.org/gitweb?p=libvpx.git;a=commitdiff_plain;h=10c50af56df5c1f5a33959da01a5bad6048086b5

fix integer promotion bug in partition size check

The check '(user_data_end - partition < partition_size)' must be
evaluated as a signed comparison, but because partition_size was
unsigned, the LHS was promoted to unsigned, causing an incorrect
result on 32-bit.

Change-Id: I6266aba7fd7de084268712a3d2a81424ead7aa06
---

diff --git a/vp8/decoder/decodframe.c b/vp8/decoder/decodframe.c
index 2d81d61..a25325f 100644
--- a/vp8/decoder/decodframe.c
+++ b/vp8/decoder/decodframe.c
@@ -412,9 +412,9 @@ void vp8_decode_mb_row(VP8D_COMP *pbi,
 }
 
 
-static unsigned int read_partition_size(const unsigned char *cx_size)
+static int read_partition_size(const unsigned char *cx_size)
 {
-    const unsigned int size =
+    const int size =
         cx_size[0] + (cx_size[1] << 8) + (cx_size[2] << 16);
     return size;
 }
@@ -448,7 +448,7 @@ static void setup_token_decoder(VP8D_COMP *pbi,
     for (i = 0; i < num_part; i++)
     {
         const unsigned char *partition_size_ptr = cx_data + i * 3;
-        unsigned int         partition_size;
+        int                  partition_size;
 
         /* Calculate the length of this partition. The last partition
          * size is implicit.
